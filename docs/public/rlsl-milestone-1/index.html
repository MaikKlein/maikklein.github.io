<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">

        <!-- Enable responsiveness on mobile devices-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

        <title>Maik Klein</title>

        <!-- CSS -->
        <link rel="stylesheet" href="https:&#x2F;&#x2F;maikklein.github.io/print.css" media="print">
        <link rel="stylesheet" href="https:&#x2F;&#x2F;maikklein.github.io/poole.css">
        <link rel="stylesheet" href="https:&#x2F;&#x2F;maikklein.github.io/lanyon.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns" crossorigin="anonymous">
        <link rel="stylesheet" href="https:&#x2F;&#x2F;maikklein.github.io/app.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css" integrity="sha384-exe4Ak6B0EoJI0ogGxjJ8rn+RN3ftPnEQrGwX59KTCl5ybGzvHGKjhPKk/KC3abb" crossorigin="anonymous">
<script sync src="https://platform.twitter.com/widgets.js"></script>
<script>
  window.onload = (function(){

    var tweet = document.getElementById("tweet");
    var id = tweet.getAttribute("tweetID");

    twttr.widgets.createTweet(
      id, tweet, 
      {
        conversation : 'none',    // or all
        linkColor    : '#cc0000', // default is blue
        theme        : 'light',    // or dark
        align        : 'center'    
      })
    .then (function (el) {
      el.contentDocument.querySelector(".footer").style.display = "none";
    });

  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.js" integrity="sha384-OMvkZ24ANLwviZR2lVq8ujbE/bUO8IR1FdBrKLQBI14Gq5Xp/lksIccGkmKL8m+h" crossorigin="anonymous"></script>
        <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
        <script src="https:&#x2F;&#x2F;maikklein.github.io/site.js"></script>
        

        
        
    <script>
        (function(d, s, id){
           var js, fjs = d.getElementsByTagName(s)[0];
           if (d.getElementById(id)) {return;}
           js = d.createElement(s); js.id = id;
           js.src = "https://assets.gfycat.com/gfycat.js";
           fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'gfycat-js'));
    </script>
    </head>

    <body>
        <div class="wrap">
            <div class="masthead">
                <div class="container">
                    <h3 class="masthead-title">
                        <a href="https:&#x2F;&#x2F;maikklein.github.io/" title="Home">Maik Klein</a>
                        <small>Blog</small>
                        <a href="https://github.com/maikklein" target="_blank"><i class="fab fa-github"></i></a>
                        <a href="https://twitter.com/MaikKlein_DEV" target="_blank"><i class="fab fa-twitter"></i></a>
                        <a href="https:&#x2F;&#x2F;maikklein.github.io/rss.xml" target="_blank"><i class="fas fa-rss"></i></a>
                        <a href="https://www.patreon.com/maikklein" target="_blank"><i class="fab fa-patreon"></i></a>
                    </h3>
                </div>
            </div>
        </div>
        <div class="content container">
            
<div class="post">
  <h1 class="post-title">RLSL - Milestone 1</h1>
  <span class="post-date">2018-02-26</span>
  <ul>
  
      <li>
          <a href="#shadertoy-default-shader">Shadertoy default shader</a>
          
      </li>
  
      <li>
          <a href="#input-variables">Input variables</a>
          
      </li>
  
      <li>
          <a href="#uniform-buffers-and-descriptor-sets">Uniform buffers and descriptor sets</a>
          
      </li>
  
      <li>
          <a href="#closures-and-pointers">Closures and pointers</a>
          
      </li>
  
      <li>
          <a href="#build-times">Build times</a>
          
      </li>
  
  </ul>
  <h2 id="shadertoy-default-shader">Shadertoy default shader</h2>
<div style='position:relative; padding-bottom:56.25%'>
    <iframe src='https://gfycat.com/ifr/UnrulyNeglectedBedbug' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;' allowfullscreen></iframe>
</div>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">#[spirv(fragment)]
fn color_frag(
    frag: Fragment,
    uv: Input&lt;N0, Vec2&lt;f32&gt;&gt;,
    time: Descriptor&lt;N2, N0, f32&gt;,
) -&gt; Output&lt;N0, Vec4&lt;f32&gt;&gt; {
    let uv = uv.data;
    let time = time.data;
    let offset = Vec3::new(0.0, 2.0, 4.0);
    let coord = uv.extend(uv.y)
        .add(offset)
        .map(move |f| f32::cos(time + f) * 0.5)
        .add(Vec3::single(0.5))
        .extend(1.0);
    Output::new(coord)
}

#[spirv(vertex)]
fn vertex(
    vertex: &amp;mut Vertex,
    pos: Input&lt;N0, Vec4&lt;f32&gt;&gt;,
    uv: Input&lt;N1, Vec2&lt;f32&gt;&gt;,
) -&gt; Output&lt;N0, Vec2&lt;f32&gt;&gt; {
    vertex.position = pos.data;
    Output::new(uv.data)
}
</code></pre>
<p>Today I reached the first milestone: translating the default shader from Shadertoy to rlsl.</p>
<h2 id="input-variables">Input variables</h2>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">uv: Input&lt;N0, Vec2&lt;f32&gt;&gt;
</code></pre>
<p>Every entry point now specifies input and uniform buffers explicitly. <code>Input&lt;N0, Vec2&lt;f32&gt;&gt;</code> tells rlsl that there is an input variable at location 0 of type <code>Vec2&lt;f32&gt;</code>. The <code>N0</code> here is a custom struct that maps to the number <code>0</code> inside rlsl. When Rust gets <code>const-generics</code>, you will be able to write <code>Input&lt;0, Vec2&lt;f32&gt;</code>.</p>
<h2 id="uniform-buffers-and-descriptor-sets">Uniform buffers and descriptor sets</h2>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">time: Descriptor&lt;N2, N0, f32&gt;,
</code></pre>
<p>Similarly to input variables, you specify descriptor sets with <code>Descriptor&lt;N2, N0, f32&gt;</code>, where currently the first type parameter is the binding and the second type parameter is the set. Also rlsl now supports the <code>std140</code> layout, and custom structs as the type parameter are also supported <code>Descriptor&lt;N0, N0, SomeStruct&gt;</code>. In the future I will also implement seamless interop of uniforms structs between rlsl and rust. Currently you have to make sure that the struct in rust is aligned properly according to the rules in std140.</p>
<h2 id="closures-and-pointers">Closures and pointers</h2>
<p>rlsl now supports closures, and closures that own the captured variables. In the future I will also allow closures to capture variables by reference. Additionally rlsl now allows pointers as variables and function parameters. While this is not allowed in SPIR-V, rlsl optimizes those pointers away.</p>
<h2 id="build-times">Build times</h2>
<p>Build times are still quick, although the examples are still very small in terms of loc.</p>
<pre data-lang="Rust" class="language-Rust "><code class="language-Rust" data-lang="Rust">âžœ  shader git:(master) time env RUST_BACKTRACE=1 RUSTC=rlsl cargo build
   Compiling shader v0.1.0 (file:&#x2F;&#x2F;&#x2F;home&#x2F;maik&#x2F;projects&#x2F;rlsl&#x2F;quad&#x2F;shader)
    Finished dev [unoptimized + debuginfo] target(s) in 0.11 secs
0.19user 0.05system 0:00.25elapsed 94%CPU (0avgtext+0avgdata 77456maxresident)k
0inputs+96outputs (0major+14998minor)pagefaults 0swaps
</code></pre>

</div>

            </div>


            <script>
             renderMathInElement(document.body,
                                 {
                                     delimiters: [
                                         {left: "$$", right: "$$", display: true},
                                         {left: "$", right: "$", display: false},
                                         {left: "\\[", right: "\\]", display: true}
                                     ],
                                 }
             );
            </script>
    </body>
</html>
